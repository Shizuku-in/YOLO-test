<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>å·¥å‚æ™ºèƒ½å®‰å…¨ç›‘æ§ç³»ç»Ÿ - MVP</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <script src="https://unpkg.com/vue@3"></script>
    <script src="https://unpkg.com/element-plus"></script>
    <style>
        body { margin: 0; background-color: #f0f2f5; font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', sans-serif; }
        .header { background-color: #001529; color: white; padding: 20px; font-size: 24px; display: flex; align-items: center; }
        .container { display: flex; padding: 20px; gap: 20px; height: calc(100vh - 80px); }
        .video-section { flex: 2; background: black; color: white; display: flex; justify-content: center; align-items: center; border-radius: 8px; position: relative;}
        .alarm-section { flex: 1; background: white; padding: 20px; border-radius: 8px; overflow-y: auto; box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1); }
        .alarm-item { border-left: 5px solid #ff4d4f; background: #fff1f0; padding: 10px; margin-bottom: 10px; border-radius: 4px; }
        .tag-0 { color: red; font-weight: bold; }
        .tag-1 { color: orange; font-weight: bold; }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <span>ğŸ›¡ï¸ å·¥å‚æ™ºèƒ½å®‰å…¨ç›‘æ§ç³»ç»Ÿ (MVP Demo)</span>
        </div>
        <div class="container">
            <div class="video-section">
                <div style="text-align: center; width: 100%; height: 100%;">
                    <h2 style="position: absolute; top: 10px; left: 20px; z-index: 10; color: #00ff00; text-shadow: 1px 1px 2px black;">
                        ğŸ”´ LIVE | è¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹ A
                    </h2>
                    
                    <img src="http://localhost:5000/stream" 
                        style="width: 100%; height: 100%; object-fit: contain; background-color: #000;" 
                        alt="ç­‰å¾…æ‘„åƒå¤´è¿æ¥..." />
                </div>
            </div>
            </div>

            <div class="alarm-section">
                <h3>ğŸ”” å®æ—¶é£é™©é¢„è­¦</h3>
                <el-empty v-if="alarms.length === 0" description="æš‚æ— å¼‚å¸¸"></el-empty>
                
                <div v-for="(alarm, index) in alarms" :key="index" class="alarm-item">
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-weight: bold;">{{ alarm.time }}</span>
                        <span :class="{'tag-0': alarm.type==='Person detected!', 'tag-1': alarm.type==='Bicycle detected!'}">{{ alarm.type }}</span>
                    </div>
                    <div style="margin-top: 5px; color: #666;">
                        ä½ç½®: {{ alarm.location }} <br>
                        è¯¦æƒ…: {{ alarm.desc }}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue;
        const { ElNotification } = ElementPlus;

        const App = {
            setup() {
                const alarms = ref([]);

                // è¿æ¥ WebSocket
                const connectWebSocket = () => {
                    const ws = new WebSocket("ws://localhost:8000/ws");
                    
                    ws.onopen = () => { console.log("äº‘ç«¯è¿æ¥æˆåŠŸ"); };
                    
                    ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        // 1. æ·»åŠ åˆ°åˆ—è¡¨
                        alarms.value.unshift(data);
                        
                        // 2. å¼¹å‡ºè­¦å‘Šæ¡†
                        ElNotification({
                            title: 'å‘ç°å®‰å…¨éšæ‚£!',
                            message: `${data.location} æ£€æµ‹åˆ° ${data.type}`,
                            type: 'error',
                            duration: 4000
                        });
                    };

                    ws.onclose = () => { 
                        console.log("è¿æ¥æ–­å¼€ï¼Œå°è¯•é‡è¿...");
                        setTimeout(connectWebSocket, 3000); 
                    };
                };

                onMounted(() => {
                    connectWebSocket();
                });

                return { alarms };
            }
        };

        const app = createApp(App);
        app.use(ElementPlus);
        app.mount("#app");
    </script>
</body>
</html>